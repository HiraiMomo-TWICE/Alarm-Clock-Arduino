[{"id":"2a17e47f.c1400c","type":"tab","label":"Flow 1","disabled":false,"info":""},{"id":"46d845ff.82232c","type":"inject","z":"2a17e47f.c1400c","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":true,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":570,"y":280,"wires":[["1ca9cdd7.9b3e72"]]},{"id":"b12a07e0.04bec8","type":"json","z":"2a17e47f.c1400c","name":"JSON Parser","property":"payload","action":"obj","pretty":true,"x":950,"y":140,"wires":[["cd3796c1.9adc78","9e408a08.3706b8"]]},{"id":"1ca9cdd7.9b3e72","type":"file in","z":"2a17e47f.c1400c","name":"Location","filename":"C:\\Users\\ASUS\\Documents\\HCMUS\\git\\Alarm-Clock-Arduino\\Alarm_Clock\\data.json","format":"utf8","chunk":false,"sendError":false,"encoding":"utf8","x":760,"y":140,"wires":[["b12a07e0.04bec8"]]},{"id":"cd3796c1.9adc78","type":"function","z":"2a17e47f.c1400c","name":"","func":"let temp = []\n\nfor (let key in msg.payload) {\n    if ((msg.payload).hasOwnProperty(key)) {\n        let opt = {};\n        opt[key] = key;\n        temp.push(opt);\n    }\n}\n\nmsg.options = temp;\n\nflow.set(\"data\", msg.payload)\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1160,"y":140,"wires":[["e6589402.355d98"]]},{"id":"2f3985fe.20329a","type":"function","z":"2a17e47f.c1400c","name":"","func":"let tempData = flow.get(\"data\")[msg.payload];\n\nlet temp = []\n\nfor(let i=0; i<tempData.length; i++){\n    let opt = {};\n    opt[tempData[i]] = tempData[i];\n    temp.push(opt)\n}\n\nmsg.options = temp;\nflow.set(\"country\", msg.payload)\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1620,"y":140,"wires":[["3e122143.8086be"]]},{"id":"b293e2a1.886d4","type":"change","z":"2a17e47f.c1400c","name":"","rules":[{"t":"set","p":"city","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":2030,"y":140,"wires":[[]]},{"id":"9e408a08.3706b8","type":"debug","z":"2a17e47f.c1400c","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":990,"y":260,"wires":[]},{"id":"7915b6ac.147ac8","type":"ui_button","z":"2a17e47f.c1400c","name":"","group":"2242a3b.bba505c","order":6,"width":"8","height":"1","passthru":false,"label":"Show Weather Data","tooltip":"","color":"","bgcolor":"","icon":"","payload":"","payloadType":"str","topic":"topic","topicType":"msg","x":580,"y":380,"wires":[["46758a00.675458"]]},{"id":"e6589402.355d98","type":"ui_dropdown","z":"2a17e47f.c1400c","name":"","label":"Country","tooltip":"","place":"Select option","group":"2242a3b.bba505c","order":4,"width":0,"height":0,"passthru":true,"multiple":false,"options":[{"label":"","value":"","type":"str"}],"payload":"","topic":"options","topicType":"msg","x":1380,"y":140,"wires":[["2f3985fe.20329a"]]},{"id":"3e122143.8086be","type":"ui_dropdown","z":"2a17e47f.c1400c","name":"","label":"City","tooltip":"","place":"Select option","group":"2242a3b.bba505c","order":5,"width":0,"height":0,"passthru":true,"multiple":false,"options":[{"label":"","value":"","type":"str"}],"payload":"","topic":"options","topicType":"msg","x":1830,"y":140,"wires":[["b293e2a1.886d4"]]},{"id":"87b110c0.6fe29","type":"openweathermap","z":"2a17e47f.c1400c","name":"Current weather","wtype":"current","lon":"","lat":"","city":"","country":"","language":"en","x":1140,"y":420,"wires":[["8f034ecd.534e5","c2c459d0.5479e8","b9012313.23f46"]]},{"id":"46758a00.675458","type":"change","z":"2a17e47f.c1400c","name":"","rules":[{"t":"delete","p":"payload","pt":"msg"},{"t":"set","p":"location","pt":"msg","to":"{}","tot":"json"},{"t":"set","p":"location.city","pt":"msg","to":"city","tot":"flow"},{"t":"set","p":"location.country","pt":"msg","to":"country","tot":"flow"},{"t":"set","p":"payload.units","pt":"msg","to":"metrics","tot":"str"},{"t":"set","p":"units","pt":"flow","to":"payload.units","tot":"msg"},{"t":"set","p":"hour12","pt":"flow","to":"false","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":840,"y":380,"wires":[["87b110c0.6fe29","6625075d.725468"]]},{"id":"631d8946.4fc458","type":"ui_gauge","z":"2a17e47f.c1400c","name":"","group":"2bfc4dd.f3aaab2","order":15,"width":0,"height":0,"gtype":"gage","title":"Humidity","label":"%","format":"{{value}}","min":"20","max":"80","colors":["#00b500","#e6e600","#ca3838"],"seg1":"","seg2":"","x":1140,"y":660,"wires":[]},{"id":"6228328f.1e18fc","type":"ui_gauge","z":"2a17e47f.c1400c","name":"","group":"2bfc4dd.f3aaab2","order":14,"width":0,"height":0,"gtype":"gage","title":"Temperature","label":"degree Celsius","format":"{{value}}","min":"0","max":"50","colors":["#00b500","#e6e600","#ca3838"],"seg1":"","seg2":"","x":1150,"y":580,"wires":[]},{"id":"96e23f30.18268","type":"mqtt in","z":"2a17e47f.c1400c","name":"","topic":"room/temperature","qos":"2","datatype":"auto","broker":"a194fdbe.3a918","x":890,"y":580,"wires":[["6228328f.1e18fc","537e4b03.97f494"]]},{"id":"bc2dec92.1308f","type":"mqtt in","z":"2a17e47f.c1400c","name":"","topic":"room/humidity","qos":"2","datatype":"auto","broker":"a194fdbe.3a918","x":910,"y":660,"wires":[["631d8946.4fc458","537e4b03.97f494"]]},{"id":"c2c459d0.5479e8","type":"function","z":"2a17e47f.c1400c","name":"Format current data","func":"var icon = {};\n\nvar units = flow.get('units');\nif (units === undefined) {units = 'imperial';}\n\nfunction timeConvert(UNIX_timestamp){\n  var dateObject = new Date(UNIX_timestamp * 1000);\n  if (flow.get('hour12')) {  // 12 hour time format\n    return dateObject.toLocaleString('en', { timezone: msg.payload.timezone, hour12: true, hour: 'numeric', minute: '2-digit'}).toLowerCase();\n  } else {  // 24 hour time format\n    return dateObject.toLocaleString('en', { timezone: msg.payload.timezone, hour12: false, hour: 'numeric', minute: '2-digit'});\n  }      \n}\n\nvar degreesToCardinal = function(deg){\n  if (deg>11.25 && deg<=33.75){return \"NNE\";}\n  else if (deg>33.75 && deg<56.25){return \"NE\";}\n  else if (deg>56.25 && deg<78.75){return \"ENE\";}\n  else if (deg>78.75 && deg<101.25){return \"E\";}\n  else if (deg>101.25 && deg<123.75){return \"ESE\";}\n  else if (deg>123.75 && deg<146.25){return \"SE\";}\n  else if (deg>146.25 && deg<168.75){return \"SSE\";}\n  else if (deg>168.75 && deg<191.25){return \"S\";}\n  else if (deg>191.25 && deg<213.75){return \"SSW\";}\n  else if (deg>213.75 && deg<236.25){return \"SW\";}\n  else if (deg>236.25 && deg<258.75){return \"WSW\";}\n  else if (deg>258.75 && deg<281.25){return \"W\";}\n  else if (deg>281.25 && deg<303.75){return \"WNW\";}\n  else if (deg>303.75 && deg<326.25){return \"NW\";}\n  else if (deg>326.25 && deg<348.75){return \"NNW\";}\n  else {return \"N\";}\n}\n\nif (units == \"imperial\")\n{\n  msg.payload.tempk = msg.payload.tempk.toFixed() + ' K';\n  msg.payload.maxtemp = msg.payload.maxtemp.toFixed() + ' K';\n  msg.payload.mintemp = msg.payload.mintemp.toFixed() + ' K';\n  msg.payload.windspeed = msg.payload.windspeed.toFixed() + ' mph';\n}\nelse  // metric units\n{\n  msg.payload.tempc = msg.payload.tempc.toFixed(1) + ' °C';\n  msg.payload.temp_maxc = msg.payload.temp_maxc.toFixed(1) + ' °C';\n  msg.payload.temp_minc = msg.payload.temp_minc.toFixed(1) + ' °C'\n  msg.payload.windspeed = msg.payload.windspeed.toFixed(1) + ' m/s';\n}\n\nmsg.payload.winddirection = degreesToCardinal(msg.payload.winddirection);\n\nmsg.payload.sunrise = timeConvert(msg.payload.sunrise);\nmsg.payload.sunset = timeConvert(msg.payload.sunset);\n\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1510,"y":500,"wires":[["b849f0b8.b6fbd","ec9c0937.8e2388","513be20c.8b279c","8e2296c.c1f2168","7fc34402.d5d8bc","e9416064.465aa","54558d15.864844","23143ac.12a76c6"]]},{"id":"7fc34402.d5d8bc","type":"ui_text","z":"2a17e47f.c1400c","group":"2242a3b.bba505c","order":11,"width":"4","height":1,"name":"SunsetTime","label":"","format":"<i class=\"wi wi-wu-sunny\"></i>&nbsp;<i class=\"fa fa-arrow-down\"></i>&nbsp;&nbsp;{{msg.payload.sunset}}","layout":"row-center","x":1750,"y":560,"wires":[]},{"id":"8e2296c.c1f2168","type":"ui_text","z":"2a17e47f.c1400c","group":"2242a3b.bba505c","order":10,"width":"4","height":1,"name":"SunriseTime","label":"","format":"<i class=\"wi wi-owm-01d\"></i>&nbsp;<i class=\"fa fa-arrow-up\"></i>&nbsp;&nbsp;{{msg.payload.sunrise}}","layout":"row-center","x":1750,"y":520,"wires":[]},{"id":"ec9c0937.8e2388","type":"ui_text","z":"2a17e47f.c1400c","group":"2242a3b.bba505c","order":9,"width":"4","height":1,"name":"Wind","label":"","format":"{{msg.payload.windspeed}}&nbsp;&nbsp;<i class=\"wi wi-darksky-wind\"></i>&nbsp;&nbsp;{{msg.payload.winddirection}}","layout":"row-center","x":1730,"y":480,"wires":[]},{"id":"b849f0b8.b6fbd","type":"ui_text","z":"2a17e47f.c1400c","group":"2242a3b.bba505c","order":8,"width":"4","height":1,"name":"Temperature","label":"","format":"<p style=\"font-size: 200%\">{{msg.payload.tempc}}</p>","layout":"row-center","x":1750,"y":440,"wires":[]},{"id":"513be20c.8b279c","type":"ui_text","z":"2a17e47f.c1400c","group":"2242a3b.bba505c","order":7,"width":"8","height":1,"name":"Description","label":"Weather Detail","format":"{{msg.payload.detail}}","layout":"row-spread","x":1750,"y":400,"wires":[]},{"id":"8f034ecd.534e5","type":"debug","z":"2a17e47f.c1400c","name":"Debug log","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":1510,"y":340,"wires":[]},{"id":"54558d15.864844","type":"ui_text","z":"2a17e47f.c1400c","group":"2242a3b.bba505c","order":12,"width":0,"height":0,"name":"","label":"Max Temperature","format":"<p style=\"font-size: 200%\">{{msg.payload.temp_maxc}}</p>","layout":"row-spread","x":1770,"y":600,"wires":[]},{"id":"e9416064.465aa","type":"ui_text","z":"2a17e47f.c1400c","group":"2242a3b.bba505c","order":13,"width":0,"height":0,"name":"","label":"Min Temperature","format":"<p style=\"font-size: 200%\">{{msg.payload.temp_minc}}</p>","layout":"row-spread","x":1770,"y":640,"wires":[]},{"id":"33b76f1e.14024","type":"ui_switch","z":"2a17e47f.c1400c","name":"","label":"Activate Alarm","tooltip":"","group":"18289928.dbb207","order":3,"width":0,"height":0,"passthru":true,"decouple":"false","topic":"topic","topicType":"msg","style":"","onvalue":"true","onvalueType":"bool","onicon":"","oncolor":"","offvalue":"false","offvalueType":"bool","officon":"","offcolor":"","animate":false,"x":660,"y":1080,"wires":[["4d8c30ff.8ab13"]]},{"id":"95105ea0.3768c","type":"ui_dropdown","z":"2a17e47f.c1400c","name":"","label":"Hour","tooltip":"","place":"Select hour","group":"18289928.dbb207","order":4,"width":"3","height":"1","passthru":true,"multiple":false,"options":[{"label":"1","value":1,"type":"num"},{"label":"2","value":2,"type":"num"},{"label":"3","value":3,"type":"num"},{"label":"4","value":4,"type":"num"},{"label":"5","value":5,"type":"num"},{"label":"6","value":6,"type":"num"},{"label":"7","value":7,"type":"num"},{"label":"8","value":8,"type":"num"},{"label":"9","value":9,"type":"num"},{"label":"10","value":10,"type":"num"},{"label":"11","value":11,"type":"num"},{"label":"12","value":12,"type":"num"},{"label":"13","value":13,"type":"num"},{"label":"14","value":14,"type":"num"},{"label":"15","value":15,"type":"num"},{"label":"16","value":16,"type":"num"},{"label":"17","value":17,"type":"num"},{"label":"18","value":18,"type":"num"},{"label":"19","value":19,"type":"num"},{"label":"20","value":20,"type":"num"},{"label":"21","value":21,"type":"num"},{"label":"22","value":22,"type":"num"},{"label":"23","value":23,"type":"num"}],"payload":"","topic":"topic","topicType":"msg","x":690,"y":1000,"wires":[["5356c52b.84e90c"]]},{"id":"9cd0b475.52dc48","type":"ui_dropdown","z":"2a17e47f.c1400c","name":"","label":"Minute","tooltip":"","place":"Select minute","group":"18289928.dbb207","order":5,"width":"3","height":"1","passthru":true,"multiple":false,"options":[{"label":"00","value":0,"type":"num"},{"label":"05","value":5,"type":"num"},{"label":"10","value":10,"type":"num"},{"label":"15","value":15,"type":"num"},{"label":"20","value":20,"type":"num"},{"label":"25","value":25,"type":"num"},{"label":"30","value":30,"type":"num"},{"label":"35","value":35,"type":"num"},{"label":"40","value":40,"type":"num"},{"label":"45","value":45,"type":"num"},{"label":"50","value":50,"type":"num"},{"label":"55","value":55,"type":"num"}],"payload":"","topic":"topic","topicType":"msg","x":690,"y":1160,"wires":[["c6f37fd5.cc62d"]]},{"id":"dc5759ab.5317a8","type":"ui_button","z":"2a17e47f.c1400c","name":"","group":"18289928.dbb207","order":6,"width":0,"height":0,"passthru":false,"label":"Set Alarm","tooltip":"","color":"","bgcolor":"","icon":"","payload":"true","payloadType":"flow","topic":"topic","topicType":"msg","x":1120,"y":1080,"wires":[["61b6f210.64e18c","465ff99a.fb8678","13096328.3840ed"]]},{"id":"ea3bad55.8e864","type":"mqtt out","z":"2a17e47f.c1400c","name":"","topic":"alarm/hour","qos":"","retain":"","broker":"a194fdbe.3a918","x":1530,"y":1000,"wires":[]},{"id":"f339f18a.b703","type":"mqtt out","z":"2a17e47f.c1400c","name":"","topic":"alarm/minute","qos":"","retain":"","broker":"a194fdbe.3a918","x":1530,"y":1160,"wires":[]},{"id":"35034858.cd2d28","type":"mqtt out","z":"2a17e47f.c1400c","name":"","topic":"alarm/isActivated","qos":"","retain":"","broker":"a194fdbe.3a918","x":1550,"y":1080,"wires":[]},{"id":"5356c52b.84e90c","type":"function","z":"2a17e47f.c1400c","name":"set hour global","func":"global.set(\"hour\", msg.payload);","outputs":1,"noerr":0,"initialize":"","finalize":"","x":900,"y":1000,"wires":[["dc5759ab.5317a8"]]},{"id":"61b6f210.64e18c","type":"function","z":"2a17e47f.c1400c","name":"get hour","func":"msg.payload = global.get(\"hour\");\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1340,"y":1000,"wires":[["ea3bad55.8e864"]]},{"id":"4d8c30ff.8ab13","type":"function","z":"2a17e47f.c1400c","name":"set activation global","func":"global.set(\"isActivated\", msg.payload);","outputs":1,"noerr":0,"initialize":"","finalize":"","x":890,"y":1080,"wires":[["dc5759ab.5317a8"]]},{"id":"c6f37fd5.cc62d","type":"function","z":"2a17e47f.c1400c","name":"set minute global","func":"global.set(\"minute\", msg.payload);","outputs":1,"noerr":0,"initialize":"","finalize":"","x":890,"y":1160,"wires":[["dc5759ab.5317a8"]]},{"id":"465ff99a.fb8678","type":"function","z":"2a17e47f.c1400c","name":"get activation","func":"msg.payload = global.get(\"isActivated\");\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1350,"y":1080,"wires":[["35034858.cd2d28"]]},{"id":"13096328.3840ed","type":"function","z":"2a17e47f.c1400c","name":"get minute","func":"msg.payload = global.get(\"minute\");\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1350,"y":1160,"wires":[["f339f18a.b703"]]},{"id":"345acec2.e4a2d2","type":"mqtt in","z":"2a17e47f.c1400c","name":"","topic":"alarm/currentHour","qos":"2","datatype":"auto","broker":"a194fdbe.3a918","x":890,"y":740,"wires":[["537e4b03.97f494","2943021b.818ade"]]},{"id":"27092c01.8e1b54","type":"mqtt in","z":"2a17e47f.c1400c","name":"","topic":"alarm/currentMinute","qos":"2","datatype":"auto","broker":"a194fdbe.3a918","x":890,"y":820,"wires":[["537e4b03.97f494","24c5c7b8.d94028"]]},{"id":"79827ad6.29a0e4","type":"ui_text","z":"2a17e47f.c1400c","group":"18289928.dbb207","order":7,"width":"6","height":"1","name":"Current Alarm Time","label":"Current Alarm Time","format":"{{msg.payload}}","layout":"row-spread","x":1470,"y":780,"wires":[]},{"id":"16f49691.e8e999","type":"ui_text","z":"2a17e47f.c1400c","group":"18289928.dbb207","order":8,"width":"6","height":"1","name":"Current Alarm Activation","label":"Current Alarm Activation","format":"{{msg.payload}}","layout":"row-spread","x":1350,"y":860,"wires":[]},{"id":"debdc963.b76768","type":"ui_template","z":"2a17e47f.c1400c","group":"2242a3b.bba505c","name":"Forecast2","order":14,"width":"8","height":"2","format":"<div style=\"height: 100%; justify-content: center; align-items: center;\">\n <div layout=\"rowicons\" layout-align=\"space-around start\" ng-repeat=\"data in msg.payload.rowicons\" style=\"font-size:150%;padding-top: 5px;padding-bottom: 5px\">\n  <span flex style=\"color: white;text-align: center\"><i class=\"wi wi-owm-{{data.cell01}}\"></i></span>\n  <span flex style=\"color: white;text-align: center\"><i class=\"wi wi-owm-{{data.cell02}}\"></i></span>\n  <span flex style=\"color: white;text-align: center\"><i class=\"wi wi-owm-{{data.cell03}}\"></i></span>\n  <span flex style=\"color: white;text-align: center\"><i class=\"wi wi-owm-{{data.cell04}}\"></i></span>\n  <span flex style=\"color: #097479;text-align: center\"><i class=\"wi wi-owm-{{data.cell07}}\"></i></span>\n  <span flex style=\"color: #097479;text-align: center\"><i class=\"wi wi-owm-{{data.cell08}}\"></i></span>\n  <span flex style=\"color: #097479;text-align: center\"><i class=\"wi wi-owm-{{data.cell09}}\"></i></span>\n  <span flex style=\"color: #097479;text-align: center\"><i class=\"wi wi-owm-{{data.cell10}}\"></i></span>\n </div>\n <div layout=\"rowtext\" layout-align=\"space-around start\" ng-repeat=\"data in msg.payload.rowtext\" style=\"line-height: 150%\">\n  <span flex style=\"color: white;text-align: center;\">{{data.cell01}}</span>\n  <span flex style=\"color: white;text-align: center\">{{data.cell02}}</span>\n  <span flex style=\"color: white;text-align: center\">{{data.cell03}}</span>\n  <span flex style=\"color: white;text-align: center\">{{data.cell04}}</span>\n  <span flex style=\"color: #097479;text-align: center\">{{data.cell07}}</span>\n  <span flex style=\"color: #097479;text-align: center\">{{data.cell08}}</span>\n  <span flex style=\"color: #097479;text-align: center\">{{data.cell09}}</span>\n  <span flex style=\"color: #097479;text-align: center\">{{data.cell10}}</span>\n </div>\n</div>","storeOutMessages":true,"fwdInMessages":true,"resendOnRefresh":false,"templateScope":"local","x":1800,"y":720,"wires":[[]]},{"id":"6625075d.725468","type":"openweathermap","z":"2a17e47f.c1400c","name":"Forecast weather","wtype":"forecast","lon":"","lat":"","city":"","country":"","language":"en","x":1130,"y":500,"wires":[["bb9b8606.4a8d48","69901d68.f45564"]]},{"id":"bb9b8606.4a8d48","type":"debug","z":"2a17e47f.c1400c","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":1530,"y":420,"wires":[]},{"id":"69901d68.f45564","type":"function","z":"2a17e47f.c1400c","name":"Format forecast data","func":"var fcdata = {};\nvar units=flow.get('units');\nif (units===undefined)\n{\n  units=\"imperial\";\n}\n\nfunction formatTemp(high, low){\n    if (units == \"imperial\") {\n        if (low){\n          temp = parseFloat(high).toFixed() + '/' + parseFloat(low).toFixed()\n        }\n        else {\n          temp = parseFloat(high).toFixed() + '°F'\n        }\n    }\n    else { // metric\n        if (low){\n          temp = parseFloat(high).toFixed() + '/' + parseFloat(low).toFixed()\n        }\n        else {\n          temp = parseFloat(high).toFixed() + '°C'\n        }\n    }\n    return temp;\n}\n\nfunction dayName(unixTime){\n  var dateObject = new Date(unixTime * 1000);\n  return dateObject.toLocaleString(flow.get('lang'), { timezone: msg.payload.timezone, weekday: 'short'});\n  // If the line above is not producing the correct short weekday names for the language set by 'lang',\n  //   you can try upgrading to NodeJS version 13 or higher (when full international support was added for the toLocaleString function),\n  //   or you can use the code below which is an example for French short weekday names.\n/*  \n  switch (dateObject.toLocaleString('en', { timezone: msg.payload.timezone, weekday: 'short'})) {\n    case 'Mon':\n      return 'Lun';\n    case 'Tue':\n      return 'Mar';\n    case 'Wed':\n      return 'Mer';\n    case 'Thu':\n      return 'Jeu';\n    case 'Fri':\n      return 'Ven';\n    case 'Sat':\n      return 'Sam';\n    case 'Sun':\n      return 'Dim';\n  }\n*/\n}\n\nfunction timeConvert(UNIX_timestamp){\n  var dateObject = new Date(UNIX_timestamp * 1000);\n  if (flow.get('hour12')) {  // 12 hour time format\n    return dateObject.toLocaleString('en', { timezone: msg.payload.timezone, hour12: true, hour: 'numeric'}).toLowerCase();\n  } else {  // 24 hour time format\n    return dateObject.toLocaleString('en', { timezone: msg.payload.timezone, hour12: false, hour: 'numeric'}) + ':00';\n  }      \n}\n\n// prepare forecast data for CSS based ui widget\nfcdata.payload = {\n  rowtext: {\n  \tdata01: {\n      cell01: timeConvert(msg.payload[5].dt),\n      cell02: timeConvert(msg.payload[6].dt),\n      cell03: timeConvert(msg.payload[7].dt),\n      cell04: timeConvert(msg.payload[8].dt),\n      cell07: dayName(msg.payload[10].dt),\n      cell08: dayName(msg.payload[20].dt),\n      cell09: dayName(msg.payload[30].dt),\n      cell10: dayName(msg.payload[39].dt),\n  \t},\n  \tdata02: {\n       cell01: formatTemp(msg.payload[5].main.temp),\n       cell02: formatTemp(msg.payload[6].main.temp),\n       cell03: formatTemp(msg.payload[7].main.temp),\n       cell04: formatTemp(msg.payload[8].main.temp),\n       cell07: formatTemp(msg.payload[10].main.temp_max, msg.payload[10].main.temp_min),\n       cell08: formatTemp(msg.payload[20].main.temp_max, msg.payload[20].main.temp_min),\n       cell09: formatTemp(msg.payload[30].main.temp_max, msg.payload[30].main.temp_min),\n       cell10: formatTemp(msg.payload[39].main.temp_max, msg.payload[39].main.temp_min),\n  \t}\n  },\n  rowicons: {\n  \tdata01: {\n  \t\tcell01: msg.payload[5].weather[0].icon,\n  \t\tcell02: msg.payload[6].weather[0].icon,\n  \t\tcell03: msg.payload[7].weather[0].icon,\n  \t\tcell04: msg.payload[8].weather[0].icon,\n  \t\tcell07: msg.payload[10].weather[0].icon,\n  \t\tcell08: msg.payload[20].weather[0].icon,\n  \t\tcell09: msg.payload[30].weather[0].icon,\n  \t\tcell10: msg.payload[39].weather[0].icon,\n  \t}\n  }\n}\n\nreturn fcdata;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1460,"y":600,"wires":[["debdc963.b76768"]]},{"id":"537e4b03.97f494","type":"thingspeak42","z":"2a17e47f.c1400c","name":"TS: Temperature","delay":"5","topic1":"room/temperature","topic2":"room/humidity","topic3":"alarm/currentHour","topic4":"alarm/currentMinute","topic5":"alarm/currentActivation","topic6":"","topic7":"","topic8":"","endpoint":"https://thingspeak.com","x":1170,"y":620,"wires":[]},{"id":"ffe90b8a.0e97f8","type":"mqtt in","z":"2a17e47f.c1400c","name":"","topic":"alarm/currentActivation","qos":"2","datatype":"auto","broker":"a194fdbe.3a918","x":880,"y":920,"wires":[["537e4b03.97f494","d3b159.887b8ea8"]]},{"id":"d3b159.887b8ea8","type":"function","z":"2a17e47f.c1400c","name":"Get Activation","func":"if (msg.payload == 1) {\n    msg.payload = \"ON\";\n} else if (msg.payload == 0) {\n    msg.payload = \"OFF\";\n}\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1100,"y":920,"wires":[["16f49691.e8e999"]]},{"id":"24c5c7b8.d94028","type":"function","z":"2a17e47f.c1400c","name":"Get Minute","func":"global.set(\"currentMinute\", msg.payload);","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1110,"y":820,"wires":[["15515e32.99e942"]]},{"id":"2943021b.818ade","type":"function","z":"2a17e47f.c1400c","name":"Get Hour","func":"global.set(\"currentHour\", msg.payload);","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1120,"y":740,"wires":[["15515e32.99e942"]]},{"id":"15515e32.99e942","type":"function","z":"2a17e47f.c1400c","name":"Combine","func":"var hour = global.get(\"currentHour\");\nvar minute = global.get(\"currentMinute\");\nvar combine = hour + ':' + minute;\nmsg.payload = combine;\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1280,"y":780,"wires":[["79827ad6.29a0e4"]]},{"id":"f3ac9b9f.8a06d8","type":"ui_text_input","z":"2a17e47f.c1400c","name":"","label":"Email Address","tooltip":"","group":"18289928.dbb207","order":1,"width":0,"height":0,"passthru":true,"mode":"email","delay":"5000","topic":"","topicType":"str","x":1300,"y":220,"wires":[["50f06a89.dfdff4"]]},{"id":"c3c3da4a.b91568","type":"ui_button","z":"2a17e47f.c1400c","name":"","group":"18289928.dbb207","order":2,"width":"6","height":"1","passthru":false,"label":"Send Weather Data to Email","tooltip":"","color":"","bgcolor":"","icon":"","payload":"true","payloadType":"bool","topic":"topic","topicType":"msg","x":1280,"y":280,"wires":[["b9012313.23f46"]]},{"id":"b9012313.23f46","type":"change","z":"2a17e47f.c1400c","name":"Convert","rules":[{"t":"set","p":"payload","pt":"msg","to":"message","tot":"flow"},{"t":"set","p":"to","pt":"msg","to":"recipient","tot":"flow"},{"t":"set","p":"topic","pt":"msg","to":"Current weather","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1500,"y":280,"wires":[["836c33f3.da839","97043b5b.3b6918","874b2e81.f6ee4"]]},{"id":"836c33f3.da839","type":"debug","z":"2a17e47f.c1400c","name":"Bla","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":1730,"y":280,"wires":[]},{"id":"97043b5b.3b6918","type":"debug","z":"2a17e47f.c1400c","name":"Ble","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"to","targetType":"msg","statusVal":"","statusType":"auto","x":1730,"y":240,"wires":[]},{"id":"50f06a89.dfdff4","type":"function","z":"2a17e47f.c1400c","name":"","func":"flow.set(\"recipient\", msg.payload)\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1520,"y":220,"wires":[[]]},{"id":"874b2e81.f6ee4","type":"e-mail","z":"2a17e47f.c1400c","server":"smtp.gmail.com","port":"465","secure":true,"tls":true,"name":"","dname":"Email sender","x":1750,"y":200,"wires":[]},{"id":"23143ac.12a76c6","type":"function","z":"2a17e47f.c1400c","name":"Message converter","func":"msg.payload = msg.payload.location + \".\\n\" +\n        \"Current weather: \" + msg.payload.weather + \".\\n\" +\n        \"Temperature: \" + msg.payload.tempc + \".\\n\" +\n        \"Humidity: \" + msg.payload.humidity + \"%\" + \".\\n\" +\n        \"Air pressure: \" + msg.payload.pressure + \"hPa\" + \".\\n\" +\n        \"Windpseed: \" + msg.payload.windspeed + \".\\n\" +\n        \"Wind direction: \" + msg.payload.winddirection + \".\\n\" +\n        \"Sunrise: \" + msg.payload.sunrise + \".\\n\" + \n        \"Sunset: \" + msg.payload.sunset + \".\\n\";\nflow.set(\"message\", msg.payload);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1770,"y":360,"wires":[[]]},{"id":"2242a3b.bba505c","type":"ui_group","name":"Default","tab":"773c1f5c.ca2f7","order":1,"disp":true,"width":"6","collapse":false},{"id":"2bfc4dd.f3aaab2","type":"ui_group","name":"Room Temperature and Humidity","tab":"773c1f5c.ca2f7","order":2,"disp":true,"width":"6","collapse":false},{"id":"a194fdbe.3a918","type":"mqtt-broker","name":"","broker":"broker.mqtt-dashboard.com","port":"1883","clientid":"","usetls":false,"compatmode":false,"keepalive":"60","cleansession":true,"birthTopic":"","birthQos":"0","birthPayload":"","closeTopic":"","closeQos":"0","closePayload":"","willTopic":"","willQos":"0","willPayload":""},{"id":"18289928.dbb207","type":"ui_group","name":"Alarm Time Picker","tab":"773c1f5c.ca2f7","order":3,"disp":true,"width":"6","collapse":false},{"id":"773c1f5c.ca2f7","type":"ui_tab","name":"Home","icon":"dashboard","disabled":false,"hidden":false}]