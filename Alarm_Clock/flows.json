[{"id":"b8b0d6e3.878d98","type":"tab","label":"Flow 1","disabled":false,"info":""},{"id":"e54b5ef9.7d938","type":"inject","z":"b8b0d6e3.878d98","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":true,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":570,"y":280,"wires":[["8976be88.6128e"]]},{"id":"2fc8cae5.370fa6","type":"json","z":"b8b0d6e3.878d98","name":"JSON Parser","property":"payload","action":"obj","pretty":true,"x":950,"y":140,"wires":[["ecfd9494.9a6978","46512b22.0655a4"]]},{"id":"8976be88.6128e","type":"file in","z":"b8b0d6e3.878d98","name":"Location","filename":"D:\\ArduinoProject\\Alarm-Clock-Arduino\\Alarm_Clock\\data.json","format":"utf8","chunk":false,"sendError":false,"encoding":"utf8","x":760,"y":140,"wires":[["2fc8cae5.370fa6"]]},{"id":"ecfd9494.9a6978","type":"function","z":"b8b0d6e3.878d98","name":"","func":"let temp = []\n\nfor (let key in msg.payload) {\n    if ((msg.payload).hasOwnProperty(key)) {\n        let opt = {};\n        opt[key] = key;\n        temp.push(opt);\n    }\n}\n\nmsg.options = temp;\n\nflow.set(\"data\", msg.payload)\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1160,"y":140,"wires":[["143147e8.431a38"]]},{"id":"906aefa8.07d85","type":"function","z":"b8b0d6e3.878d98","name":"","func":"let tempData = flow.get(\"data\")[msg.payload];\n\nlet temp = []\n\nfor(let i=0; i<tempData.length; i++){\n    let opt = {};\n    opt[tempData[i]] = tempData[i];\n    temp.push(opt)\n}\n\nmsg.options = temp;\nflow.set(\"country\", msg.payload)\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1620,"y":140,"wires":[["46621de7.eb1214"]]},{"id":"94def1d6.ea4f3","type":"change","z":"b8b0d6e3.878d98","name":"","rules":[{"t":"set","p":"city","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":2030,"y":140,"wires":[[]]},{"id":"46512b22.0655a4","type":"debug","z":"b8b0d6e3.878d98","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":990,"y":260,"wires":[]},{"id":"a1cbbae6.e646c8","type":"ui_button","z":"b8b0d6e3.878d98","name":"","group":"2242a3b.bba505c","order":6,"width":"8","height":"1","passthru":false,"label":"Show Weather Data","tooltip":"","color":"","bgcolor":"","icon":"","payload":"","payloadType":"str","topic":"topic","topicType":"msg","x":560,"y":540,"wires":[["74a3d088.f0a96"]]},{"id":"143147e8.431a38","type":"ui_dropdown","z":"b8b0d6e3.878d98","name":"","label":"Country","tooltip":"","place":"Select option","group":"2242a3b.bba505c","order":4,"width":0,"height":0,"passthru":true,"multiple":false,"options":[{"label":"","value":"","type":"str"}],"payload":"","topic":"options","topicType":"msg","x":1380,"y":140,"wires":[["906aefa8.07d85"]]},{"id":"46621de7.eb1214","type":"ui_dropdown","z":"b8b0d6e3.878d98","name":"","label":"City","tooltip":"","place":"Select option","group":"2242a3b.bba505c","order":5,"width":0,"height":0,"passthru":true,"multiple":false,"options":[{"label":"","value":"","type":"str"}],"payload":"","topic":"options","topicType":"msg","x":1830,"y":140,"wires":[["94def1d6.ea4f3"]]},{"id":"c2a093ed.8274e","type":"openweathermap","z":"b8b0d6e3.878d98","name":"Current weather","wtype":"current","lon":"","lat":"","city":"","country":"","language":"en","x":1120,"y":580,"wires":[["d095ce7b.b2ac3","972f8030.d2216"]]},{"id":"74a3d088.f0a96","type":"change","z":"b8b0d6e3.878d98","name":"","rules":[{"t":"delete","p":"payload","pt":"msg"},{"t":"set","p":"location","pt":"msg","to":"{}","tot":"json"},{"t":"set","p":"location.city","pt":"msg","to":"city","tot":"flow"},{"t":"set","p":"location.country","pt":"msg","to":"country","tot":"flow"},{"t":"set","p":"payload.units","pt":"msg","to":"metrics","tot":"str"},{"t":"set","p":"units","pt":"flow","to":"payload.units","tot":"msg"},{"t":"set","p":"hour12","pt":"flow","to":"false","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":820,"y":540,"wires":[["c2a093ed.8274e","a2393124.1ffdd"]]},{"id":"d00219d0.dfa7b8","type":"ui_gauge","z":"b8b0d6e3.878d98","name":"","group":"f92e7447.efea98","order":15,"width":0,"height":0,"gtype":"gage","title":"Humidity","label":"%","format":"{{value}}","min":"20","max":"80","colors":["#00b500","#e6e600","#ca3838"],"seg1":"","seg2":"","x":940,"y":780,"wires":[]},{"id":"a3127ee0.e57fe","type":"ui_gauge","z":"b8b0d6e3.878d98","name":"","group":"f92e7447.efea98","order":14,"width":0,"height":0,"gtype":"gage","title":"Temperature","label":"degree Celsius","format":"{{value}}","min":"0","max":"50","colors":["#00b500","#e6e600","#ca3838"],"seg1":"","seg2":"","x":950,"y":700,"wires":[]},{"id":"f5000f97.aaa64","type":"mqtt in","z":"b8b0d6e3.878d98","name":"","topic":"room/temperature","qos":"2","datatype":"auto","broker":"9f101d0b.d466c","x":690,"y":700,"wires":[["a3127ee0.e57fe","818d9e66.f0015"]]},{"id":"33e4fed1.780262","type":"mqtt in","z":"b8b0d6e3.878d98","name":"","topic":"room/humidity","qos":"2","datatype":"auto","broker":"9f101d0b.d466c","x":710,"y":780,"wires":[["d00219d0.dfa7b8","818d9e66.f0015"]]},{"id":"972f8030.d2216","type":"function","z":"b8b0d6e3.878d98","name":"Format current data","func":"var icon = {};\n\nvar units = flow.get('units');\nif (units === undefined) {units = 'imperial';}\n\nfunction timeConvert(UNIX_timestamp){\n  var dateObject = new Date(UNIX_timestamp * 1000);\n  if (flow.get('hour12')) {  // 12 hour time format\n    return dateObject.toLocaleString('en', { timezone: msg.payload.timezone, hour12: true, hour: 'numeric', minute: '2-digit'}).toLowerCase();\n  } else {  // 24 hour time format\n    return dateObject.toLocaleString('en', { timezone: msg.payload.timezone, hour12: false, hour: 'numeric', minute: '2-digit'});\n  }      \n}\n\nvar degreesToCardinal = function(deg){\n  if (deg>11.25 && deg<=33.75){return \"NNE\";}\n  else if (deg>33.75 && deg<56.25){return \"NE\";}\n  else if (deg>56.25 && deg<78.75){return \"ENE\";}\n  else if (deg>78.75 && deg<101.25){return \"E\";}\n  else if (deg>101.25 && deg<123.75){return \"ESE\";}\n  else if (deg>123.75 && deg<146.25){return \"SE\";}\n  else if (deg>146.25 && deg<168.75){return \"SSE\";}\n  else if (deg>168.75 && deg<191.25){return \"S\";}\n  else if (deg>191.25 && deg<213.75){return \"SSW\";}\n  else if (deg>213.75 && deg<236.25){return \"SW\";}\n  else if (deg>236.25 && deg<258.75){return \"WSW\";}\n  else if (deg>258.75 && deg<281.25){return \"W\";}\n  else if (deg>281.25 && deg<303.75){return \"WNW\";}\n  else if (deg>303.75 && deg<326.25){return \"NW\";}\n  else if (deg>326.25 && deg<348.75){return \"NNW\";}\n  else {return \"N\";}\n}\n\nif (units == \"imperial\")\n{\n  msg.payload.tempk = msg.payload.tempk.toFixed() + ' K';\n  msg.payload.maxtemp = msg.payload.maxtemp.toFixed() + ' K';\n  msg.payload.mintemp = msg.payload.mintemp.toFixed() + ' K';\n  msg.payload.windspeed = msg.payload.windspeed.toFixed() + ' mph';\n}\nelse  // metric units\n{\n  msg.payload.tempc = msg.payload.tempc.toFixed(1) + ' °C';\n  msg.payload.temp_maxc = msg.payload.temp_maxc.toFixed(1) + ' °C';\n  msg.payload.temp_minc = msg.payload.temp_minc.toFixed(1) + ' °C'\n  msg.payload.windspeed = msg.payload.windspeed.toFixed(1) + ' m/s';\n}\n\nmsg.payload.winddirection = degreesToCardinal(msg.payload.winddirection);\n\nmsg.payload.sunrise = timeConvert(msg.payload.sunrise);\nmsg.payload.sunset = timeConvert(msg.payload.sunset);\n\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1390,"y":720,"wires":[["e657086c.974a38","2fe13e1a.14f702","b790aafc.966028","ff888eec.a5cb6","dccbcd4a.3c68a","3fee0c86.b594c4","d918ae6b.9a43f","882ae590.b8b4a8"]]},{"id":"dccbcd4a.3c68a","type":"ui_text","z":"b8b0d6e3.878d98","group":"2242a3b.bba505c","order":11,"width":"4","height":1,"name":"SunsetTime","label":"","format":"<i class=\"wi wi-wu-sunny\"></i>&nbsp;<i class=\"fa fa-arrow-down\"></i>&nbsp;&nbsp;{{msg.payload.sunset}}","layout":"row-center","x":1610,"y":780,"wires":[]},{"id":"ff888eec.a5cb6","type":"ui_text","z":"b8b0d6e3.878d98","group":"2242a3b.bba505c","order":10,"width":"4","height":1,"name":"SunriseTime","label":"","format":"<i class=\"wi wi-owm-01d\"></i>&nbsp;<i class=\"fa fa-arrow-up\"></i>&nbsp;&nbsp;{{msg.payload.sunrise}}","layout":"row-center","x":1610,"y":740,"wires":[]},{"id":"2fe13e1a.14f702","type":"ui_text","z":"b8b0d6e3.878d98","group":"2242a3b.bba505c","order":9,"width":"4","height":1,"name":"Wind","label":"","format":"{{msg.payload.windspeed}}&nbsp;&nbsp;<i class=\"wi wi-darksky-wind\"></i>&nbsp;&nbsp;{{msg.payload.winddirection}}","layout":"row-center","x":1590,"y":700,"wires":[]},{"id":"e657086c.974a38","type":"ui_text","z":"b8b0d6e3.878d98","group":"2242a3b.bba505c","order":8,"width":"4","height":1,"name":"Temperature","label":"","format":"<p style=\"font-size: 200%\">{{msg.payload.tempc}}</p>","layout":"row-center","x":1610,"y":660,"wires":[]},{"id":"b790aafc.966028","type":"ui_text","z":"b8b0d6e3.878d98","group":"2242a3b.bba505c","order":7,"width":"8","height":1,"name":"Description","label":"Weather Detail","format":"{{msg.payload.detail}}","layout":"row-spread","x":1610,"y":620,"wires":[]},{"id":"d095ce7b.b2ac3","type":"debug","z":"b8b0d6e3.878d98","name":"Debug log","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":1370,"y":560,"wires":[]},{"id":"3fee0c86.b594c4","type":"debug","z":"b8b0d6e3.878d98","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":1610,"y":560,"wires":[]},{"id":"882ae590.b8b4a8","type":"ui_text","z":"b8b0d6e3.878d98","group":"2242a3b.bba505c","order":12,"width":0,"height":0,"name":"","label":"Max Temperature","format":"<p style=\"font-size: 200%\">{{msg.payload.temp_maxc}}</p>","layout":"row-spread","x":1630,"y":820,"wires":[]},{"id":"d918ae6b.9a43f","type":"ui_text","z":"b8b0d6e3.878d98","group":"2242a3b.bba505c","order":13,"width":0,"height":0,"name":"","label":"Min Temperature","format":"<p style=\"font-size: 200%\">{{msg.payload.temp_minc}}</p>","layout":"row-spread","x":1630,"y":860,"wires":[]},{"id":"e24db4a3.dd28d8","type":"ui_switch","z":"b8b0d6e3.878d98","name":"","label":"Activate Alarm","tooltip":"","group":"1eb0bbf4.6b3df4","order":3,"width":0,"height":0,"passthru":true,"decouple":"false","topic":"topic","topicType":"msg","style":"","onvalue":"true","onvalueType":"bool","onicon":"","oncolor":"","offvalue":"false","offvalueType":"bool","officon":"","offcolor":"","animate":false,"x":660,"y":1240,"wires":[["b04e44c0.ecd8b8"]]},{"id":"d0d5d26f.90a3f","type":"ui_dropdown","z":"b8b0d6e3.878d98","name":"","label":"Hour","tooltip":"","place":"Select hour","group":"1eb0bbf4.6b3df4","order":4,"width":"3","height":"1","passthru":true,"multiple":false,"options":[{"label":"1","value":1,"type":"num"},{"label":"2","value":2,"type":"num"},{"label":"3","value":3,"type":"num"},{"label":"4","value":4,"type":"num"},{"label":"5","value":5,"type":"num"},{"label":"6","value":6,"type":"num"},{"label":"7","value":7,"type":"num"},{"label":"8","value":8,"type":"num"},{"label":"9","value":9,"type":"num"},{"label":"10","value":10,"type":"num"},{"label":"11","value":11,"type":"num"},{"label":"12","value":12,"type":"num"},{"label":"13","value":13,"type":"num"},{"label":"14","value":14,"type":"num"},{"label":"15","value":15,"type":"num"},{"label":"16","value":16,"type":"num"},{"label":"17","value":17,"type":"num"},{"label":"18","value":18,"type":"num"},{"label":"19","value":19,"type":"num"},{"label":"20","value":20,"type":"num"},{"label":"21","value":21,"type":"num"},{"label":"22","value":22,"type":"num"},{"label":"23","value":23,"type":"num"}],"payload":"","topic":"topic","topicType":"msg","x":690,"y":1160,"wires":[["58b91b09.6ec734"]]},{"id":"c3f537c1.f404c8","type":"ui_dropdown","z":"b8b0d6e3.878d98","name":"","label":"Minute","tooltip":"","place":"Select minute","group":"1eb0bbf4.6b3df4","order":5,"width":"3","height":"1","passthru":true,"multiple":false,"options":[{"label":"00","value":0,"type":"num"},{"label":"05","value":5,"type":"num"},{"label":"10","value":10,"type":"num"},{"label":"15","value":15,"type":"num"},{"label":"20","value":20,"type":"num"},{"label":"25","value":25,"type":"num"},{"label":"30","value":30,"type":"num"},{"label":"35","value":35,"type":"num"},{"label":"40","value":40,"type":"num"},{"label":"45","value":45,"type":"num"},{"label":"50","value":50,"type":"num"},{"label":"55","value":55,"type":"num"}],"payload":"","topic":"topic","topicType":"msg","x":690,"y":1320,"wires":[["e5606138.af487"]]},{"id":"fc845558.4aacd8","type":"ui_button","z":"b8b0d6e3.878d98","name":"","group":"1eb0bbf4.6b3df4","order":6,"width":0,"height":0,"passthru":false,"label":"Set Alarm","tooltip":"","color":"","bgcolor":"","icon":"","payload":"true","payloadType":"flow","topic":"topic","topicType":"msg","x":1120,"y":1240,"wires":[["52c6530.2ef64ac","4afc44fc.39627c","49f6cda3.5fb154"]]},{"id":"1e41114e.e5b74f","type":"mqtt out","z":"b8b0d6e3.878d98","name":"","topic":"alarm/hour","qos":"","retain":"","broker":"9f101d0b.d466c","x":1530,"y":1160,"wires":[]},{"id":"e60f06f7.b04e58","type":"mqtt out","z":"b8b0d6e3.878d98","name":"","topic":"alarm/minute","qos":"","retain":"","broker":"9f101d0b.d466c","x":1530,"y":1320,"wires":[]},{"id":"d61039dc.7d1828","type":"mqtt out","z":"b8b0d6e3.878d98","name":"","topic":"alarm/isActivated","qos":"","retain":"","broker":"9f101d0b.d466c","x":1550,"y":1240,"wires":[]},{"id":"58b91b09.6ec734","type":"function","z":"b8b0d6e3.878d98","name":"set hour global","func":"global.set(\"hour\", msg.payload);","outputs":1,"noerr":0,"initialize":"","finalize":"","x":900,"y":1160,"wires":[["fc845558.4aacd8"]]},{"id":"52c6530.2ef64ac","type":"function","z":"b8b0d6e3.878d98","name":"get hour","func":"msg.payload = global.get(\"hour\");\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1340,"y":1160,"wires":[["1e41114e.e5b74f"]]},{"id":"b04e44c0.ecd8b8","type":"function","z":"b8b0d6e3.878d98","name":"set activation global","func":"global.set(\"isActivated\", msg.payload);","outputs":1,"noerr":0,"initialize":"","finalize":"","x":890,"y":1240,"wires":[["fc845558.4aacd8"]]},{"id":"e5606138.af487","type":"function","z":"b8b0d6e3.878d98","name":"set minute global","func":"global.set(\"minute\", msg.payload);","outputs":1,"noerr":0,"initialize":"","finalize":"","x":890,"y":1320,"wires":[["fc845558.4aacd8"]]},{"id":"4afc44fc.39627c","type":"function","z":"b8b0d6e3.878d98","name":"get activation","func":"msg.payload = global.get(\"isActivated\");\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1350,"y":1240,"wires":[["d61039dc.7d1828"]]},{"id":"49f6cda3.5fb154","type":"function","z":"b8b0d6e3.878d98","name":"get minute","func":"msg.payload = global.get(\"minute\");\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1350,"y":1320,"wires":[["e60f06f7.b04e58"]]},{"id":"855f3961.1574e8","type":"mqtt in","z":"b8b0d6e3.878d98","name":"","topic":"alarm/currentHour","qos":"2","datatype":"auto","broker":"9f101d0b.d466c","x":690,"y":860,"wires":[["818d9e66.f0015","75fbece2.e411b4"]]},{"id":"e1d95666.02bb78","type":"mqtt in","z":"b8b0d6e3.878d98","name":"","topic":"alarm/currentMinute","qos":"2","datatype":"auto","broker":"9f101d0b.d466c","x":690,"y":940,"wires":[["818d9e66.f0015","e81a4a41.c00328"]]},{"id":"f3f0981a.fe1298","type":"ui_text","z":"b8b0d6e3.878d98","group":"1eb0bbf4.6b3df4","order":7,"width":"6","height":"1","name":"Current Alarm Time","label":"Current Alarm Time","format":"{{msg.payload}}","layout":"row-spread","x":1270,"y":900,"wires":[]},{"id":"378489cf.391a66","type":"ui_text","z":"b8b0d6e3.878d98","group":"1eb0bbf4.6b3df4","order":8,"width":"6","height":"1","name":"Current Alarm Activation","label":"Current Alarm Activation","format":"{{msg.payload}}","layout":"row-spread","x":1150,"y":980,"wires":[]},{"id":"4cc15f20.88e1e","type":"ui_template","z":"b8b0d6e3.878d98","group":"2242a3b.bba505c","name":"Forecast2","order":14,"width":"8","height":"2","format":"<div style=\"height: 100%; justify-content: center; align-items: center;\">\n <div layout=\"rowicons\" layout-align=\"space-around start\" ng-repeat=\"data in msg.payload.rowicons\" style=\"font-size:150%;padding-top: 5px;padding-bottom: 5px\">\n  <span flex style=\"color: white;text-align: center\"><i class=\"wi wi-owm-{{data.cell01}}\"></i></span>\n  <span flex style=\"color: white;text-align: center\"><i class=\"wi wi-owm-{{data.cell02}}\"></i></span>\n  <span flex style=\"color: white;text-align: center\"><i class=\"wi wi-owm-{{data.cell03}}\"></i></span>\n  <span flex style=\"color: white;text-align: center\"><i class=\"wi wi-owm-{{data.cell04}}\"></i></span>\n  <span flex style=\"color: #097479;text-align: center\"><i class=\"wi wi-owm-{{data.cell07}}\"></i></span>\n  <span flex style=\"color: #097479;text-align: center\"><i class=\"wi wi-owm-{{data.cell08}}\"></i></span>\n  <span flex style=\"color: #097479;text-align: center\"><i class=\"wi wi-owm-{{data.cell09}}\"></i></span>\n  <span flex style=\"color: #097479;text-align: center\"><i class=\"wi wi-owm-{{data.cell10}}\"></i></span>\n </div>\n <div layout=\"rowtext\" layout-align=\"space-around start\" ng-repeat=\"data in msg.payload.rowtext\" style=\"line-height: 150%\">\n  <span flex style=\"color: white;text-align: center;\">{{data.cell01}}</span>\n  <span flex style=\"color: white;text-align: center\">{{data.cell02}}</span>\n  <span flex style=\"color: white;text-align: center\">{{data.cell03}}</span>\n  <span flex style=\"color: white;text-align: center\">{{data.cell04}}</span>\n  <span flex style=\"color: #097479;text-align: center\">{{data.cell07}}</span>\n  <span flex style=\"color: #097479;text-align: center\">{{data.cell08}}</span>\n  <span flex style=\"color: #097479;text-align: center\">{{data.cell09}}</span>\n  <span flex style=\"color: #097479;text-align: center\">{{data.cell10}}</span>\n </div>\n</div>","storeOutMessages":true,"fwdInMessages":true,"resendOnRefresh":false,"templateScope":"local","x":1660,"y":940,"wires":[[]]},{"id":"a2393124.1ffdd","type":"openweathermap","z":"b8b0d6e3.878d98","name":"Forecast weather","wtype":"forecast","lon":"","lat":"","city":"","country":"","language":"en","x":1110,"y":660,"wires":[["b9c5d72d.3852f8","e44351da.b57b"]]},{"id":"b9c5d72d.3852f8","type":"debug","z":"b8b0d6e3.878d98","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":1390,"y":640,"wires":[]},{"id":"e44351da.b57b","type":"function","z":"b8b0d6e3.878d98","name":"Format forecast data","func":"var fcdata = {};\nvar units=flow.get('units');\nif (units===undefined)\n{\n  units=\"imperial\";\n}\n\nfunction formatTemp(high, low){\n    if (units == \"imperial\") {\n        if (low){\n          temp = parseFloat(high).toFixed() + '/' + parseFloat(low).toFixed()\n        }\n        else {\n          temp = parseFloat(high).toFixed() + '°F'\n        }\n    }\n    else { // metric\n        if (low){\n          temp = parseFloat(high).toFixed() + '/' + parseFloat(low).toFixed()\n        }\n        else {\n          temp = parseFloat(high).toFixed() + '°C'\n        }\n    }\n    return temp;\n}\n\nfunction dayName(unixTime){\n  var dateObject = new Date(unixTime * 1000);\n  return dateObject.toLocaleString(flow.get('lang'), { timezone: msg.payload.timezone, weekday: 'short'});\n  // If the line above is not producing the correct short weekday names for the language set by 'lang',\n  //   you can try upgrading to NodeJS version 13 or higher (when full international support was added for the toLocaleString function),\n  //   or you can use the code below which is an example for French short weekday names.\n/*  \n  switch (dateObject.toLocaleString('en', { timezone: msg.payload.timezone, weekday: 'short'})) {\n    case 'Mon':\n      return 'Lun';\n    case 'Tue':\n      return 'Mar';\n    case 'Wed':\n      return 'Mer';\n    case 'Thu':\n      return 'Jeu';\n    case 'Fri':\n      return 'Ven';\n    case 'Sat':\n      return 'Sam';\n    case 'Sun':\n      return 'Dim';\n  }\n*/\n}\n\nfunction timeConvert(UNIX_timestamp){\n  var dateObject = new Date(UNIX_timestamp * 1000);\n  if (flow.get('hour12')) {  // 12 hour time format\n    return dateObject.toLocaleString('en', { timezone: msg.payload.timezone, hour12: true, hour: 'numeric'}).toLowerCase();\n  } else {  // 24 hour time format\n    return dateObject.toLocaleString('en', { timezone: msg.payload.timezone, hour12: false, hour: 'numeric'}) + ':00';\n  }      \n}\n\n// prepare forecast data for CSS based ui widget\nfcdata.payload = {\n  rowtext: {\n  \tdata01: {\n      cell01: timeConvert(msg.payload[5].dt),\n      cell02: timeConvert(msg.payload[6].dt),\n      cell03: timeConvert(msg.payload[7].dt),\n      cell04: timeConvert(msg.payload[8].dt),\n      cell07: dayName(msg.payload[10].dt),\n      cell08: dayName(msg.payload[20].dt),\n      cell09: dayName(msg.payload[30].dt),\n      cell10: dayName(msg.payload[39].dt),\n  \t},\n  \tdata02: {\n       cell01: formatTemp(msg.payload[5].main.temp),\n       cell02: formatTemp(msg.payload[6].main.temp),\n       cell03: formatTemp(msg.payload[7].main.temp),\n       cell04: formatTemp(msg.payload[8].main.temp),\n       cell07: formatTemp(msg.payload[10].main.temp_max, msg.payload[10].main.temp_min),\n       cell08: formatTemp(msg.payload[20].main.temp_max, msg.payload[20].main.temp_min),\n       cell09: formatTemp(msg.payload[30].main.temp_max, msg.payload[30].main.temp_min),\n       cell10: formatTemp(msg.payload[39].main.temp_max, msg.payload[39].main.temp_min),\n  \t}\n  },\n  rowicons: {\n  \tdata01: {\n  \t\tcell01: msg.payload[5].weather[0].icon,\n  \t\tcell02: msg.payload[6].weather[0].icon,\n  \t\tcell03: msg.payload[7].weather[0].icon,\n  \t\tcell04: msg.payload[8].weather[0].icon,\n  \t\tcell07: msg.payload[10].weather[0].icon,\n  \t\tcell08: msg.payload[20].weather[0].icon,\n  \t\tcell09: msg.payload[30].weather[0].icon,\n  \t\tcell10: msg.payload[39].weather[0].icon,\n  \t}\n  }\n}\n\nreturn fcdata;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1360,"y":820,"wires":[["4cc15f20.88e1e"]]},{"id":"818d9e66.f0015","type":"thingspeak42","z":"b8b0d6e3.878d98","name":"TS: Temperature","delay":"5","topic1":"room/temperature","topic2":"room/humidity","topic3":"alarm/currentHour","topic4":"alarm/currentMinute","topic5":"alarm/currentActivation","topic6":"","topic7":"","topic8":"","endpoint":"https://thingspeak.com","x":970,"y":740,"wires":[]},{"id":"e36d5940.380c88","type":"mqtt in","z":"b8b0d6e3.878d98","name":"","topic":"alarm/currentActivation","qos":"2","datatype":"auto","broker":"9f101d0b.d466c","x":680,"y":1040,"wires":[["818d9e66.f0015","6ad50982.ff4d08"]]},{"id":"6ad50982.ff4d08","type":"function","z":"b8b0d6e3.878d98","name":"Get Activation","func":"if (msg.payload == 1) {\n    msg.payload = \"ON\";\n} else if (msg.payload == 0) {\n    msg.payload = \"OFF\";\n}\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":900,"y":1040,"wires":[["378489cf.391a66"]]},{"id":"e81a4a41.c00328","type":"function","z":"b8b0d6e3.878d98","name":"Get Minute","func":"global.set(\"currentMinute\", msg.payload);","outputs":1,"noerr":0,"initialize":"","finalize":"","x":910,"y":940,"wires":[["4bdf4b24.b3cd64"]]},{"id":"75fbece2.e411b4","type":"function","z":"b8b0d6e3.878d98","name":"Get Hour","func":"global.set(\"currentHour\", msg.payload);","outputs":1,"noerr":0,"initialize":"","finalize":"","x":920,"y":860,"wires":[["4bdf4b24.b3cd64"]]},{"id":"4bdf4b24.b3cd64","type":"function","z":"b8b0d6e3.878d98","name":"Combine","func":"var hour = global.get(\"currentHour\");\nvar minute = global.get(\"currentMinute\");\nvar combine = hour + ':' + minute;\nmsg.payload = combine;\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1080,"y":900,"wires":[["f3f0981a.fe1298"]]},{"id":"2242a3b.bba505c","type":"ui_group","name":"Weather Data","tab":"773c1f5c.ca2f7","order":1,"disp":true,"width":"8","collapse":false},{"id":"f92e7447.efea98","type":"ui_group","name":"Room Temperature and Humidity","tab":"773c1f5c.ca2f7","order":2,"disp":true,"width":"6","collapse":false},{"id":"9f101d0b.d466c","type":"mqtt-broker","name":"","broker":"broker.mqtt-dashboard.com","port":"1883","clientid":"","usetls":false,"compatmode":false,"keepalive":"60","cleansession":true,"birthTopic":"","birthQos":"0","birthPayload":"","closeTopic":"","closeQos":"0","closePayload":"","willTopic":"","willQos":"0","willPayload":""},{"id":"1eb0bbf4.6b3df4","type":"ui_group","name":"Alarm Time Picker","tab":"773c1f5c.ca2f7","order":3,"disp":true,"width":"6","collapse":false},{"id":"773c1f5c.ca2f7","type":"ui_tab","name":"Alarm Clock Project IoT","icon":"dashboard","disabled":false,"hidden":false}]